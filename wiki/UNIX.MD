# Шпаргалка по UNIX (проверено на Linux Red Hat Enterprise, Oracle Linux)

## Алгоритмы решения проблем

### Завершение сеанса пользователя SSH (кикнуть пользователя)

1. Ищем TTY нужного пользователя командой `w`

	Получаем что-то врорде:
	```
	USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
	emb      pts/0    195.133.29.136   18:25    5.00s  0.06s  0.02s sshd: emb [priv]
	emb      pts/1    195.133.29.136   17:36   43:32   0.03s  0.03s -bash
	pazik98  pts/2    83.139.167.83    17:52   44:32   0.02s  0.02s -bash
	pazik98  pts/3    83.139.167.83    18:06   35:00   0.02s  0.02s -bash
	pazik98  pts/4    83.139.167.83    18:22    2:35   1:17   0.00s sshd: pazik98 [priv]
	```

	> Часто бывает нужно выкинуть неактивного пользователя; чтобы определить такового,
	> ориентируемся на колонку IDLE (время бездействия).

2. Завершаем его SSH сессию по TTY:
	```
	pkill -9 -t pts/<id>
	```

	**Где**: \
	`<id>` - целочисленный идентификатор сессии пользователя.


### Включение аутентификации по паролю

1. Переходим в каталог, в которой лежит конфигурация ssh сервера
	```
	cd /etc/ssh
	```
	Там будет много файлов, например директория `ssh_config.d` в которой хранятся
	файлы дополнительной конфигурации, но интересующий нас файл - **`sshd_config`**.
	> Oracle Linux или Red Hat, судя по всему используют какой-то модифицированный OpenSSH,
	> о чём свидетельствует отсутствие службы ssh (sshd вместо неё), соответственно, 
	> вместо файла `ssh_config` используется `sshd_config` и именно он влияет на работу SSH-сервера.

2. Открываем файл `sshd_config`, с правами root
	```
	sudo vi sshd_config `ssh_config`
	```

3. Ищем строку **PasswordAuthentication**
	Для этого нужно нажать `ESC`, затем `:` и ввести `/PasswordAuthentication`,
	должно получиться:
	```
	:/PasswordAuthentication
	```
	И нажимаем `Enter`
	> Если такой строки нет (Vim её не найдёт) - нужно просто её дописать (см. следующий шаг)

4. Изменяем параметр **PasswordAuthentication** на *yes*
	Для этого необхоодимо перейти в режим ввода, нажатием клавиши `i`.
	В результате у нас должно получиться вместо **PasswordAuthentication no** (или её отсутствия)
	**PasswordAuthentication yes**

5. Сохраняем изменения
	Нажимаем `ESC`, вводим: `:wq`. Нажимаем `Enter`.

6. Перезапускаем службу SSH
	```
	sudo service sshd restart
	```
	> Система может перенаправить запрос, и ответить сообщением вроде:
	> *Authentication is required to restart 'sshd.service'.* Следственно эта служба может быть
	> найдена в указанной директории, однако, скорее всего этого не потребуется.
	Готово.

### Разрешение для пользователя подклюючаться по SSH

1. Переходим в каталог, в которой лежит конфигурация ssh сервера
	```
	cd /etc/ssh
	```
	Там будет много файлов, например директория `ssh_config.d` в которой хранятся
	файлы дополнительной конфигурации, но интересующий нас файл - **`sshd_config`**.
	> Oracle Linux или Red Hat, судя по всему используют какой-то модифицированный OpenSSH,
	> о чём свидетельствует отсутствие службы ssh (sshd вместо неё), соответственно, 
	> вместо файла `ssh_config` используется `sshd_config` и именно он влияет на работу SSH-сервера.

2. Открываем файл `sshd_config`, с правами root
	```
	sudo vi sshd_config `ssh_config`
	```

3. Ищем строку **AllowUsers**
	Для этого нужно нажать `ESC`, затем `:` и ввести `/AllowUsers`,
	должно получиться:
	```
	:/AllowUsers
	```
	И нажимаем `Enter`
	> Если такой строки нет (Vim её не найдёт) - нужно просто её дописать (см. следующий шаг)

4. Добавляем в строку **AllowUsers** необходимых пользователей
	Для этого необхоодимо перейти в режим ввода, нажатием клавиши `i`.
	В результате у нас должно получиться:
	`AllowUsers <usr0> <usr1> ...`
	**Где**:
	`<usr0>`, `<usr1>` - список пользователей, которым будет доступно подключение по SSH
	(без запятых)

5. Сохраняем изменения
	Нажимаем `ESC`, вводим: `:wq`. Нажимаем `Enter`.

6. Перезапускаем службу SSH
	```
	sudo service sshd restart
	```
	> Система может перенаправить запрос, и ответить сообщением вроде:
	> *Authentication is required to restart 'sshd.service'.* Следственно эта служба может быть
	> найдена в указанной директории, однако, скорее всего этого не потребуется.
	Готово.

## Быстрый список команд

### Работа с файлами

*	`visudo <file>` - открыть файл на редактирование в безопасном режиме (исп. для важных системных файлов)

### Работа с группами

*	`getent group` или `less /etc/group` - вывести список групп пользователей
*	`getent group <group>` - список пользователей в группе (<group> - название группы)
*	`groupmod -n <old> <new>` - изменить название группы

### Работа с пользователями

*	`useradd -g <main_group> -G <group_list> <username>` - создание пользователя
*	`runuser -l <user> -c <command>` - запуск команды <command> от имени пользователя <user>
*	`sudo -u<user>` <command> - запуск команды <command> от имени пользователя <user>
*	`su <user>` - сменить пользователя (switch user) на <user>

### Типы пользователей
В ОС Linux существует три типа пользователей:

**root** (от англ. root - корень) - суперпользователь, аккаунт в UNIX-подобных системах,
владелец которого имеет право на выполнение всех операций без исключения.
Присутствует в системе по умолчанию.

**Системные пользователи** - системные процессы у которых есть учетные записи для
управления привилегиями и правами доступа к файлам и каталогам.
Создаются системой автоматически.

**Обычные пользователи** - учетные записи пользователей, допущенных к управлению системой.
Создаются системным администратором.